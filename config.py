# config.py
import os
from dotenv import load_dotenv

load_dotenv()

# ====================================================================
# НАСТРОЙКИ ПОДКЛЮЧЕНИЯ
# ====================================================================
TWITCH_TOKEN = os.getenv("TWITCH_TOKEN")
TWITCH_NICK = os.getenv("TWITCH_NICK")
TWITCH_CHANNELS = os.getenv("TWITCH_CHANNEL", "").split(',')

GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")
MODEL_NAME = "gemma-3-27b-it"

# ====================================================================
# ⚙️ ОСНОВНЫЕ ПАРАМЕТРЫ (МОЖНО МЕНЯТЬ)
# ====================================================================

# --- ДЛИНА СООБЩЕНИЙ ---
# Максимальная длина обычного ответа (символы)
MAX_RESPONSE_LENGTH = 200  # Уменьшено с 350 для более кратких ответов

# Максимальная длина при упоминании бота (символы)
MAX_RESPONSE_LENGTH_MENTIONED = 700  # Новый параметр: длиннее при @теге

# Лимит Twitch на одно сообщение (не менять)
MESSAGE_MAX_LENGTH = 450

# --- ЧАСТОТА ОТВЕТОВ БОТА ---
# Минимальное время между автоматическими ответами (секунды)
# Чем больше значение, тем реже бот пишет сам
MIN_RESPONSE_COOLDOWN = 120  # Увеличено с 60 до 120 секунд (2 минуты)

# Максимальное время между автоматическими ответами (секунды)
# Бот может ответить в случайный момент между MIN и MAX
MAX_RESPONSE_COOLDOWN = 300  # 5 минут

# Минимальная активность чата для ответа бота (сообщений)
# Бот ответит только если после последнего его сообщения было N сообщений
MIN_MESSAGES_BEFORE_RESPONSE = 8  # Бот ответит только после 8+ сообщений других

# Вероятность ответа бота на сообщение (0.0 - 1.0)
# 0.15 = 15% шанс ответить, если прошли кулдауны
RESPONSE_PROBABILITY = 0.2  # 20% шанс

# --- "УСТАЛОСТЬ" БОТА ---
# При какой активности (сообщений/минуту) бот начинает "уставать"
CHAT_HIGH_ACTIVITY_THRESHOLD = 50  # Если больше 50 сообщений в минуту

# Множитель для кулдаунов при усталости
FATIGUE_COOLDOWN_MULTIPLIER = 1.5  # Кулдауны x1.5 при активном чате

# Шанс сократить ответ при усталости (0.0 - 1.0)
FATIGUE_SHORT_RESPONSE_CHANCE = 0.7  # 70% шанс ответить односложно

# --- "АФК" РЕЖИМ ---
# Минимальная длительность "отошла" (секунды)
AFK_MIN_DURATION = 900  # 15 минут

# Максимальная длительность "отошла" (секунды)
AFK_MAX_DURATION = 1800  # 30 минут

# Шанс уйти в АФК после очередного ответа (0.0 - 1.0)
AFK_PROBABILITY = 0.05  # 5% шанс "отойти" после ответа

# --- НАСТРОЕНИЕ БОТА (0-100) ---
# Начальное настроение
INITIAL_MOOD = 60  # Нейтрально-позитивное

# Изменение настроения от позитивного сообщения
MOOD_INCREASE_POSITIVE = 3

# Изменение настроения от негативного сообщения
MOOD_DECREASE_NEGATIVE = 5

# Изменение настроения при игноре (никто не отвечает)
MOOD_DECREASE_IGNORED = 2

# Минимальное и максимальное значение настроения
MOOD_MIN = 20
MOOD_MAX = 100

# --- ЧЕЛОВЕЧЕСКИЕ ПАТТЕРНЫ ---
# Вероятность опечатки в сообщении (0.0 - 1.0)
TYPO_PROBABILITY = 0.03  # 3% шанс опечатки

# Вероятность разбить сообщение на две части (0.0 - 1.0)
SPLIT_MESSAGE_PROBABILITY = 0.05  # 5% шанс

# Вероятность использовать междометия (0.0 - 1.0)
INTERJECTION_PROBABILITY = 0.3  # 30% шанс

# --- КОНТЕКСТ И ПАМЯТЬ ---
# Количество последних сообщений для контекста
CONTEXT_MESSAGE_LIMIT = 10  # Увеличено для лучшего понимания

# Количество фактов о пользователях для хранения
MAX_USER_FACTS = 50  # Максимум фактов в памяти

# Вероятность вспомнить факт о пользователе (0.0 - 1.0)
RECALL_USER_FACT_PROBABILITY = 0.15  # 15% шанс упомянуть факт

# Количество последних тем для отслеживания
TOPIC_MEMORY_SIZE = 5  # Помним 5 последних тем

# --- СМАЙЛИКИ ---
# Загружать ли смайлы с 7TV
FETCH_7TV_EMOTES = True

# Размер "помойки" для смайликов (не использовать повторно N последних)
EMOTE_COOLDOWN_SIZE = 15  # Увеличено с 8

# Вероятность добавить смайлик в конец (0.0 - 1.0)
EMOTE_ADD_PROBABILITY = 0.4  # 40% шанс

# --- АНТИ-ТИШИНА ---
# Через сколько секунд тишины бот напишет сам
SILENCE_THRESHOLD = 10000  # ~2.7 часа

# Минимальный перерыв между сообщениями от тишины
BOT_SILENCE_COOLDOWN = 28800  # 8 часов

# --- ИМИТАЦИЯ ПЕЧАТИ ---
# Минимальная задержка перед ответом (секунды)
MIN_TYPING_DELAY = 1.5

# Максимальная задержка перед ответом (секунды)
MAX_TYPING_DELAY = 4.0

# ====================================================================
# СЛУЖЕБНЫЕ ПАРАМЕТРЫ
# ====================================================================
RETRY_MAX_ATTEMPTS = 3
RETRY_BASE_DELAY = 4

# Фильтр запрещенных слов
FORBIDDEN_WORDS = [
    "пидр", "пидор", "пидарас", "пидорас", "педик", "гомик",
    "нигер", "ниггер", "негр", "нига", "nigger", "nigga", "niger",
    "хохол", "хач", "жид", "москаль", "ватник", "даун", "аутист"
]

# Позитивные/негативные индикаторы для настроения
POSITIVE_INDICATORS = ['lul', 'lol', 'kek', 'pog', 'nice', 'good', 'хорошо', 'круто', 'топ', 'класс']
NEGATIVE_INDICATORS = ['плохо', 'бред', 'отстой', 'sad', 'monkas', 'weird', 'zzz', 'boring']

INTERJECTIONS = ['ну', 'эм', 'хмм', 'типа', 'короче', 'кстати', 'вот']

TYPO_MAP = {
    'а': ['о', 'я'],
    'о': ['а', 'п'],
    'е': ['и', 'у'],
    'и': ['е', 'о'],
    'т': ['р', 'п'],
    'н': ['т', 'б'],
    'р': ['т', 'е'],
    'в': ['ф', 'м'],
    'п': ['о', 'р'],
}

# Ключевые слова для определения смены темы
TOPIC_CHANGE_KEYWORDS = [
    "кстати", "а вот", "слушай", "вопрос", "тема", "другое",
    "забыл сказать", "еще", "ещё", "а ты", "расскажи", "что думаешь"
]
