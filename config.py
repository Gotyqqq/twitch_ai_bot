# config.py
import os
from dotenv import load_dotenv

load_dotenv()

# ====================================================================
# НАСТРОЙКИ ПОДКЛЮЧЕНИЯ
# ====================================================================
TWITCH_TOKEN = os.getenv("TWITCH_TOKEN")
TWITCH_NICK = os.getenv("TWITCH_NICK")
TWITCH_CHANNELS = os.getenv("TWITCH_CHANNEL", "").split(',')

GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")
MODEL_NAME = "gemma-3-27b-it"
AI_MODEL = MODEL_NAME  # Alias for consistency

# ====================================================================
# ⚙️ ОСНОВНЫЕ ПАРАМЕТРЫ (МОЖНО МЕНЯТЬ)
# ====================================================================

# --- ДЛИНА СООБЩЕНИЙ ---
MAX_RESPONSE_LENGTH = 200
MAX_RESPONSE_LENGTH_MENTIONED = 700
MESSAGE_MAX_LENGTH = 450

# --- ЧАСТОТА ОТВЕТОВ БОТА ---
MIN_RESPONSE_COOLDOWN = 120
MAX_RESPONSE_COOLDOWN = 300
MIN_MESSAGES_BEFORE_RESPONSE = 8
RESPONSE_PROBABILITY = 0.05  # Вероятность простого ответа без AI (теперь 5% вместо 20%)

# --- "УСТАЛОСТЬ" БОТА ---
CHAT_HIGH_ACTIVITY_THRESHOLD = 50
FATIGUE_COOLDOWN_MULTIPLIER = 1.5
FATIGUE_SHORT_RESPONSE_CHANCE = 0.7

# --- ЭНЕРГЕТИЧЕСКИЕ ЦИКЛЫ ---
ENERGY_NIGHT = 20
ENERGY_MORNING = 50
ENERGY_DAY = 80
ENERGY_AFTERNOON = 70
ENERGY_EVENING = 90
ENERGY_LATE = 40
ENERGY_DRAIN_PER_30_MESSAGES = 10
ENERGY_DRAIN_PER_60_MESSAGES = 20
ENERGY_RESTORE_AFTER_SILENCE = 30
ENERGY_MIN = 10
ENERGY_MAX = 100

# --- РЕЖИМ ЗАНЯТОСТИ ---
BUSY_MIN_DURATION = 600
BUSY_MAX_DURATION = 1800
BUSY_PROBABILITY = 0.08
BUSY_RESPONSE_CHANCE = 0.2
BUSY_SHORT_RESPONSES = ["сек", "щас", "минутку", "занята", "отошла", "позже отвечу"]
BUSY_MODE_CHANCE = BUSY_PROBABILITY  # Алиас
BUSY_MODE_MIN_DURATION = BUSY_MIN_DURATION  # Алиас
BUSY_MODE_MAX_DURATION = BUSY_MAX_DURATION  # Алиас

AFK_MIN_DURATION = BUSY_MIN_DURATION
AFK_MAX_DURATION = BUSY_MAX_DURATION
AFK_PROBABILITY = BUSY_PROBABILITY

# --- НАСТРОЕНИЕ БОТА (0-100) ---
INITIAL_MOOD = 60
MOOD_INCREASE_POSITIVE = 3
MOOD_DECREASE_NEGATIVE = 5
MOOD_DECREASE_IGNORED = 2
MOOD_INERTIA_NORMAL = 0.85
MOOD_INERTIA_NEGATIVE = 0.92
MOOD_INERTIA_POSITIVE = 0.80
MOOD_MIN = 20
MOOD_MAX = 100

# --- ЧЕЛОВЕЧЕСКИЕ ПАТТЕРНЫ ---
TYPO_PROBABILITY = 0.08
TYPO_FIX_PROBABILITY = 0.3
SPLIT_MESSAGE_PROBABILITY = 0.05
INTERJECTION_PROBABILITY = 0.3
DELAYED_RESPONSE_CHANCE = 0.25
DELAYED_RESPONSE_PROBABILITY = DELAYED_RESPONSE_CHANCE  # Алиас
DELAYED_RESPONSE_MIN = 20
DELAYED_RESPONSE_MAX = 180

# --- КОНТЕКСТ И ПАМЯТЬ ---
CONTEXT_MESSAGE_LIMIT = 10
CONTEXT_SIZE = CONTEXT_MESSAGE_LIMIT  # Алиас
MAX_USER_FACTS = 50
RECALL_USER_FACT_PROBABILITY = 0.15
TOPIC_MEMORY_SIZE = 5

# --- ИНДИВИДУАЛЬНЫЕ ОТНОШЕНИЯ ---
RELATIONSHIP_ACQUAINTANCE_THRESHOLD = 10
RELATIONSHIP_FRIEND_THRESHOLD = 30
RELATIONSHIP_FAVORITE_THRESHOLD = 50
RELATIONSHIP_TOXIC_THRESHOLD = 5
RELATIONSHIP_STRANGER_MODIFIER = 0.0
RELATIONSHIP_ACQUAINTANCE_MODIFIER = 0.1
RELATIONSHIP_FRIEND_MODIFIER = 0.2
RELATIONSHIP_FAVORITE_MODIFIER = 0.3
RELATIONSHIP_TOXIC_MODIFIER = -0.3

# --- СМАЙЛИКИ ---
FETCH_7TV_EMOTES = True
EMOTE_COOLDOWN_SIZE = 20  # Было 15
EMOTE_ADD_PROBABILITY = 0.3  # Было 0.4

# --- АНТИ-ТИШИНА ---
SILENCE_THRESHOLD = 10000
BOT_SILENCE_COOLDOWN = 28800

# Discord эмодзи в формате :emoji:
DISCORD_EMOTES = [
    ":smile:", ":laughing:", ":blush:", ":heart:", ":heart_eyes:",
    ":kissing_heart:", ":relaxed:", ":grin:", ":wink:", ":stuck_out_tongue_winking_eye:",
    ":stuck_out_tongue_closed_eyes:", ":stuck_out_tongue:", ":flushed:", ":grinning:",
    ":pensive:", ":relieved:", ":unamused:", ":disappointed:", ":persevere:",
    ":cry:", ":joy:", ":sob:", ":sleepy:", ":disappointed_relieved:",
    ":cold_sweat:", ":sweat_smile:", ":sweat:", ":weary:", ":tired_face:",
    ":fearful:", ":scream:", ":angry:", ":rage:", ":triumph:",
    ":confounded:", ":laughing:", ":yum:", ":mask:", ":sunglasses:",
    ":sleeping:", ":dizzy_face:", ":astonished:", ":worried:", ":frowning:",
    ":anguished:", ":smiling_imp:", ":imp:", ":open_mouth:", ":grimacing:",
    ":neutral_face:", ":confused:", ":hushed:", ":no_mouth:", ":innocent:",
    ":smirk:", ":expressionless:", ":thinking:", ":shrug:", ":wave:",
    ":raised_hand:", ":ok_hand:", ":thumbsup:", ":thumbsdown:", ":clap:",
    ":fire:", ":100:", ":eyes:", ":skull:", ":ghost:",
    ":alien:", ":robot:", ":poop:", ":clown:", ":nerd:",
]

# Английская -> Русская раскладка
EN_TO_RU_LAYOUT = {
    'q': 'й', 'w': 'ц', 'e': 'у', 'r': 'к', 't': 'е', 'y': 'н', 'u': 'г', 'i': 'ш', 'o': 'щ', 'p': 'з',
    '[': 'х', ']': 'ъ', 'a': 'ф', 's': 'ы', 'd': 'в', 'f': 'а', 'g': 'п', 'h': 'р', 'j': 'о', 'k': 'л',
    'l': 'д', ';': 'ж', "'": 'э', 'z': 'я', 'x': 'ч', 'c': 'с', 'v': 'м', 'b': 'и', 'n': 'т', 'm': 'ь',
    ',': 'б', '.': 'ю', '/': '.',
    'Q': 'Й', 'W': 'Ц', 'E': 'У', 'R': 'К', 'T': 'Е', 'Y': 'Н', 'U': 'Г', 'I': 'Ш', 'O': 'Щ', 'P': 'З',
    '{': 'Х', '}': 'Ъ', 'A': 'Ф', 'S': 'Ы', 'D': 'В', 'F': 'А', 'G': 'П', 'H': 'Р', 'J': 'О', 'K': 'Л',
    'L': 'Д', ':': 'Ж', '"': 'Э', 'Z': 'Я', 'X': 'Ч', 'C': 'С', 'V': 'М', 'B': 'И', 'N': 'Т', 'M': 'Ь',
    '<': 'Б', '>': 'Ю', '?': ',',
}

# Русская -> Английская раскладка
RU_TO_EN_LAYOUT = {
    'й': 'q', 'ц': 'w', 'у': 'e', 'к': 'r', 'е': 't', 'н': 'y', 'г': 'u', 'ш': 'i', 'щ': 'o', 'з': 'p',
    'х': '[', 'ъ': ']', 'ф': 'a', 'ы': 's', 'в': 'd', 'а': 'f', 'п': 'g', 'р': 'h', 'о': 'j', 'л': 'k',
    'д': 'l', 'ж': ';', 'э': "'", 'я': 'z', 'ч': 'x', 'с': 'c', 'м': 'v', 'и': 'b', 'т': 'n', 'ь': 'm',
    'б': ',', 'ю': '.', '.': '/',
    'Й': 'Q', 'Ц': 'W', 'У': 'E', 'К': 'R', 'Е': 'T', 'Н': 'Y', 'Г': 'U', 'Ш': 'I', 'Щ': 'O', 'З': 'P',
    'Х': '{', 'Ъ': '}', 'Ф': 'A', 'Ы': 'S', 'В': 'D', 'А': 'F', 'П': 'G', 'Р': 'H', 'О': 'J', 'Л': 'K',
    'Д': 'L', 'Ж': ':', 'Э': '"', 'Я': 'Z', 'Ч': 'X', 'С': 'C', 'М': 'V', 'И': 'B', 'Т': 'N', 'Ь': 'M',
    'Б': '<', 'Ю': '>', ',': '?',
}

# --- ИМИТАЦИЯ ПЕЧАТИ ---
WPM_MIN = 150
WPM_NORMAL = 220
WPM_FAST = 280
THINKING_DELAY_MIN = 0.5
THINKING_DELAY_MAX = 3.0
THINKING_DELAY_QUESTION = 2.0
THINKING_DELAY_LONG = 1.5
PAUSE_COMMA = 0.2
PAUSE_PERIOD = 0.4
PAUSE_QUESTION = 0.5
MIN_TYPING_DELAY = 1.5
MAX_TYPING_DELAY = 4.0

# ====================================================================
# СЛУЖЕБНЫЕ ПАРАМЕТРЫ
# ====================================================================
RETRY_MAX_ATTEMPTS = 3
RETRY_BASE_DELAY = 4

MASS_REACTION_THRESHOLD = 3  # Минимум 3 одинаковых эмодзи для массовой реакции

FORBIDDEN_WORDS = [
    "пидр", "пидор", "пидарас", "пидорас", "педик", "гомик",
    "нигер", "ниггер", "негр", "нига", "nigger", "nigga", "niger",
    "хохол", "хач", "жид", "москаль", "ватник", "даун", "аутист"
]

POSITIVE_INDICATORS = ['lul', 'lol', 'kek', 'pog', 'nice', 'good', 'хорошо', 'круто', 'топ', 'класс', 'ахах', 'хах']
NEGATIVE_INDICATORS = ['плохо', 'бред', 'отстой', 'sad', 'monkas', 'weird', 'zzz', 'boring', 'скучно', 'грустно']

INTERJECTIONS = ['ну', 'эм', 'хмм', 'типа', 'короче', 'кстати', 'вот', 'так', 'короч', 'блин']

TYPO_MAP = {
    'а': ['о', 'я'],
    'о': ['а', 'п'],
    'е': ['и', 'у'],
    'и': ['е', 'о'],
    'т': ['р', 'п'],
    'н': ['т', 'б'],
    'р': ['т', 'е'],
    'в': ['ф', 'м'],
    'п': ['о', 'р'],
    'с': ['ы', 'в'],
    'л': ['д', 'о'],
    'к': ['у', 'л'],
}

TYPO_REPLACEMENTS = {
    "привет": ["превет", "прив", "приветт", "привт"],
    "что-то": ["чёт", "чота", "чет"],
    "вообще": ["вапще", "ваще", "вобще"],
    "нормально": ["норм", "нормас", "нормуль"],
    "спасибо": ["спс", "сяп", "спасиб"],
    "кстати": ["кст", "кстате", "кста"],
    "сейчас": ["щас", "ща", "сяс", "сечас"],
    "думаю": ["думаю", "думу"],
    "наверное": ["наверн", "наверно", "наверняка"],
    "может": ["мож", "можт", "може"],
    "ладно": ["ладн", "окей", "ок"],
    "понятно": ["понятн", "пон", "понял"],
    "хорошо": ["хорош", "харашо", "хорошо"],
    "просто": ["прост", "проста"],
    "сегодня": ["сёдня", "седня"],
    "завтра": ["завтра", "завтро"],
    "вчера": ["вчера", "вчира"],
    "смотрю": ["смотрю", "смотр"],
    "слушаю": ["слушаю", "слуш"],
    "понимаю": ["понимаю", "пониваю"],
    "знаю": ["знаю", "зна"],
    "делаю": ["делаю", "делу"],
    "хочу": ["хочу", "хочю"],
    "могу": ["могу", "магу"],
    "буду": ["буду", "буду"],
    "было": ["было", "быль"],
    "будет": ["будет", "будит"],
    "говорю": ["говорю", "гаварю"],
    "видел": ["видел", "видил"],
    "слышал": ["слышал", "слышол"],
}

TOPIC_CHANGE_KEYWORDS = [
    "кстати", "а вот", "слушай", "вопрос", "тема", "другое",
    "забыл сказать", "еще", "ещё", "а ты", "расскажи", "что думаешь"
]

KEYWORD_TRIGGERS = {
    # Еда
    "пицца": ["хочу пиццу!", "ммм пицца", "теперь я тоже голодная"],
    "еда": ["есть хочу", "голодная", "что поесть бы"],
    "поесть": ["голодная", "есть хочу", "тоже хочу"],
    "голод": ["я тоже голодная", "поесть бы"],
    "обед": ["тоже хочу есть", "голодная"],
    "ужин": ["есть хочу", "голодная уже"],
    "завтрак": ["хочу кушать", "голодная"],
    "бургер": ["теперь хочу", "ммм"],
    "суши": ["обожаю суши!", "хочу тоже"],
    "шаурма": ["мммм", "теперь хочу"],
    
    # Сон и усталость
    "спать": ["я тоже устала", "сонная уже", "пора спать"],
    "устал": ["я тоже", "усталость"],
    "сон": ["хочу спать", "сонная"],
    "спокойной": ["споки", "пока"],
    "доброе утро": ["доброе", "утречко"],
    
    # Игры
    "игра": ["во что играем?", "какая игра?"],
    "играть": ["во что?", "что играем?"],
    "дота": ["dota hard", "2к часов"],
    "cs": ["лет 10 не играла", "стрелялки"],
    "кс": ["не играю", "сложно"],
    "майнкрафт": ["копать", "строить"],
    "valorant": ["не играла", "сложно"],
    "overwatch": ["когда-то играла"],
    "лига": ["lol", "не играю"],
    "league": ["не играю в мобы"],
    
    # Музыка
    "музыка": ["что слушаем?", "какая музыка?"],
    "песня": ["какая песня?", "что играет?"],
    "трек": ["что за трек?", "какой трек?"],
    "концерт": ["хочу на концерт", "где концерт?"],
    "группа": ["какая группа?", "что за группа?"],
    
    # Погода и время
    "погода": ["какая погода?", "холодно?"],
    "дождь": ["дождь опять", "промокну"],
    "снег": ["снег идет?", "холодно"],
    "жара": ["жарко", "умираю от жары"],
    "холод": ["мерзну", "холодно"],
    
    # Эмоции и реакции
    "смешно": ["ахах", "лол"],
    "грустно": ["обнять?", "все будет ок"],
    "скучно": ["я тоже", "скукота"],
    "весело": ["кайф", "круто"],
    "обидно": ["понимаю", "обидно да"],
    
    # Учеба и работа
    "экзамен": ["удачи!", "сдашь"],
    "работа": ["тяжко?", "как работа?"],
    "учеба": ["учиться сложно", "как учеба?"],
    "универ": ["студенты страдают", "тяжко"],
    "зачет": ["сдашь", "удачи"],
    
    # Стрим и твич
    "стрим": ["стрим топ", "смотрю"],
    "донат": ["пог донат", "красавчик"],
    "сабка": ["саб пог", "спс за саб"],
    "рейд": ["рейд откуда?", "привет рейдерам"],
    "чат": ["чат топ", "чат рулит"],
    
    # Мемы и сленг
    "кек": ["кекв", "ахах"],
    "пепега": ["pepega", "глупость"],
    "пог": ["погчамп", "pog"],
    "омега": ["омегалул", "lul"],
    "монка": ["монкас", "страшно"],
    "based": ["базированно", "топ"],
    "cringe": ["кринж", "ну такое"],
    
    # Животные
    "кот": ["мяу", "котик", "люблю котов"],
    "собака": ["гав", "песики топ"],
    "хомяк": ["хомячок", "милый"],
    
    # Технологии
    "комп": ["что с компом?", "сломался?"],
    "пк": ["что с пк?"],
    "фпс": ["лаги?", "фризы?"],
    "интернет": ["инет упал?", "лаги"],
    "лаг": ["лагает", "фризы"],
    
    # Праздники
    "др": ["с др!", "поздравляю"],
    "день рождения": ["поздравляю!", "с днюхой"],
    "нг": ["с нг!", "с новым годом"],
    "новый год": ["с нг!", "поздравляю"],
}

FACT_EXTRACTION_PATTERNS = [
    (r'я (играю|люблю|смотрю|слушаю|занимаюсь|работаю|учусь) (.+)', 2),
    (r'у меня (.+)', 1),
    (r'я (.+ лет|.+ года)', 1),
    (r'моя любимая (.+)', 1),
    (r'мне (нравится|не нравится) (.+)', 2),
    (r'я (хочу|не хочу) (.+)', 2),
    (r'я (умею|не умею) (.+)', 2),
    (r'я живу в (.+)', 1),
    (r'я из (.+)', 1),
]
