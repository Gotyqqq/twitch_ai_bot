# config.py - Конфигурация максимально человечного бота
import os
from dotenv import load_dotenv
from datetime import time

load_dotenv()

# ====================================================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ====================================================================
TWITCH_TOKEN = os.getenv("TWITCH_TOKEN")
TWITCH_NICK = os.getenv("TWITCH_NICK", "bot_username").lower()
TWITCH_CHANNELS = [ch.strip() for ch in os.getenv("TWITCH_CHANNEL", "").split(',') if ch.strip()]

# API ключи (Mistral - умная, Gemma - быстрая)
MISTRAL_API_KEY = os.getenv("MISTRAL_API_KEY")
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")

# ====================================================================
# СИСТЕМА ДВУХ ИИ
# ====================================================================
# Модель-анализатор (Mistral) - анализирует контекст, эмоции, отношения
ANALYZER_MODEL = "mistral-medium"  # Для глубокого анализа
ANALYZER_CONTEXT_SIZE = 15         # Сколько сообщений анализировать
ANALYZER_UPDATE_INTERVAL = 30      # Как часто обновлять анализ (сек)

# Модель-ответчик (Gemma) - генерирует ответы на основе анализа
RESPONDER_MODEL = "gemma-3-27b-it"
RESPONDER_TEMPERATURE = 0.92       # Высокая температура для разнообразия

# ====================================================================
# ЧЕЛОВЕЧЕСКИЕ ПАРАМЕТРЫ
# ====================================================================
# ИМИТАЦИЯ ЧЕЛОВЕКА
HUMAN_TYPING_SPEED_WPM = 180       # Скорость печати (слов/минуту)
THINKING_TIME_MIN = 1.5            # Минимальное время "на подумать" (сек)
THINKING_TIME_MAX = 4.5            # Максимальное время "на подумать"
RESPONSE_VARIABILITY = 0.3         # Как сильно менять стиль ответов (0-1)

# ОПЕЧАТКИ И ЕСТЕСТВЕННОСТЬ
TYPO_PROBABILITY = 0.15            # Вероятность опечатки
TYPO_FIX_PROBABILITY = 0.25        # Вероятность исправить опечатку
STUTTER_PROBABILITY = 0.05         # Вероятность запинки (типа...)

# РАСПИСАНИЕ АКТИВНОСТИ (когда бот "бодрствует")
ACTIVE_HOURS = {
    'morning': (9, 12),     # Утро
    'day': (14, 18),        # День
    'evening': (20, 23),    # Вечер
    'night': (0, 3),        # Ночь (для ночных стримов)
}

# ====================================================================
# ЭМОЦИОНАЛЬНАЯ СИСТЕМА
# ====================================================================
INITIAL_MOOD = 70
MOOD_MIN = 20
MOOD_MAX = 100

# Эмоциональные состояния и их проявления
EMOTION_STATES = {
    'excited': {'energy': 90, 'emotes': ['PogChamp', 'Pog', 'KEKW', 'LUL'], 'typo_chance': 0.2},
    'happy': {'energy': 75, 'emotes': ['FeelsGoodMan', 'Kappa', 'Okayge'], 'typo_chance': 0.1},
    'neutral': {'energy': 50, 'emotes': ['Kappa', '4Head'], 'typo_chance': 0.05},
    'tired': {'energy': 30, 'emotes': ['Sadge', 'FeelsBadMan'], 'typo_chance': 0.02},
    'grumpy': {'energy': 40, 'emotes': ['WeirdChamp', 'MonkaS'], 'typo_chance': 0.01},
}

# ====================================================================
# СМАЙЛИКИ И 7TV СИСТЕМА
# ====================================================================
# Загрузка смайликов
FETCH_7TV_EMOTES = True
FETCH_BTTV_EMOTES = True
FETCH_FFZ_EMOTES = True

# Система "помойки" для смайликов
EMOTE_COOLDOWN_TIME = 300          # 5 минут в "помойке"
EMOTE_REUSE_PENALTY = 0.7         # Штраф за повторное использование
EMOTE_DIVERSITY_BONUS = 1.3       # Бонус за разнообразие
MAX_CONSECUTIVE_SAME_EMOTE = 3    # Не использовать один смайлик более N раз

# Приоритеты смайликов
EMOTE_PRIORITIES = {
    '7tv': 1.5,      # Самые приоритетные
    'bttv': 1.3,
    'ffz': 1.2,
    'twitch': 1.0,   # Базовые твич смайлы
}

# ====================================================================
# СИСТЕМА ОТВЕТОВ
# ====================================================================
# Частота ответов
RESPONSE_PROBABILITY_BASE = 0.18
MIN_MESSAGES_BEFORE_RESPONSE = 5
RESPONSE_COOLDOWN_MIN = 90
RESPONSE_COOLDOWN_MAX = 240

# Длина ответов
SHORT_RESPONSE_MAX = 120          # Короткий ответ
MEDIUM_RESPONSE_MAX = 250         # Средний ответ
LONG_RESPONSE_MAX = 400           # Длинный ответ (при упоминании)

# ====================================================================
# КОНТЕКСТ И ПАМЯТЬ
# ====================================================================
CONTEXT_WINDOW_SIZE = 20           # Сообщений для контекста
TOPIC_MEMORY_SIZE = 8              # Тем в памяти
USER_FACT_MEMORY = 10              # Фактов о пользователе

# Веса для разных типов сообщений в контексте
CONTEXT_WEIGHTS = {
    'mentioned': 3.0,      # Сообщения с упоминанием бота
    'question': 2.0,       # Вопросы
    'emotional': 1.5,      # Эмоциональные сообщения
    'normal': 1.0,         # Обычные сообщения
    'bot_own': 0.5,        # Собственные сообщения бота
}

# ====================================================================
# ОТНОШЕНИЯ С ПОЛЬЗОВАТЕЛЯМИ
# ====================================================================
RELATIONSHIP_LEVELS = {
    'stranger': {'response_bonus': 0.0, 'trust': 0.1},
    'acquaintance': {'response_bonus': 0.1, 'trust': 0.3},
    'friend': {'response_bonus': 0.2, 'trust': 0.6},
    'close_friend': {'response_bonus': 0.3, 'trust': 0.8},
    'favorite': {'response_bonus': 0.4, 'trust': 0.9},
    'toxic': {'response_bonus': -0.3, 'trust': 0.0},
}

# ====================================================================
# АНТИ-ТИШИНА И АКТИВНОСТЬ
# ====================================================================
SILENCE_THRESHOLD = 300            # 5 минут тишины
ACTIVITY_CHECK_INTERVAL = 60       # Проверять активность каждую минуту
ENERGY_DECAY_PER_MESSAGE = 0.5     # Усталость за сообщение
ENERGY_RESTORE_PER_MINUTE = 1.2    # Восстановление энергии в минуту

# ====================================================================
# БЕЗОПАСНОСТЬ И ФИЛЬТРЫ
# ====================================================================
FORBIDDEN_WORDS = [
    "пидр", "пидор", "пидарас", "педик", "нигер", "ниггер",
    "хохол", "хач", "жид", "даун", "аутист", "дебил"
]

# ====================================================================
# СИСТЕМНЫЕ НАСТРОЙКИ
# ====================================================================
RETRY_ATTEMPTS = 2
RETRY_DELAY = 2
LOG_LEVEL = "INFO"